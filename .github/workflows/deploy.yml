name: Deploy LegalAI

on:
  push:
    branches:
      - main

concurrency:
  group: deploy-legalai
  cancel-in-progress: false

jobs:
  # 1) Backend tests (reusable workflow)
  backend_tests:
    name: Backend tests
    uses: ./.github/workflows/backend-tests.yml

  # 2) Frontend CI (reusable workflow)
  frontend_tests:
    name: Frontend CI
    uses: ./.github/workflows/frontend-ci.yml

  # 3) Deploy backend (reusable workflow)
  deploy_backend:
    name: Deploy backend
    needs:
      - backend_tests
      - frontend_tests
    uses: ./.github/workflows/deploy-backend.yml
    secrets: inherit
