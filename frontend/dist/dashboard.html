<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>LegalAI ‚Äî –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
    <link rel="stylesheet" href="/css/styles.css" />

    <style>
        :root {
            --bg-light: #e6f2ff;           /* —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π —Ñ–æ–Ω */
            --bg-light-elevated: #ffffff;
            --bg-dark: #081a33;            /* —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
            --bg-dark-elevated: #10264a;
            --accent: #2563eb;             /* —è—Ä–∫–∏–π —Å–∏–Ω–∏–π */
            --accent-soft: #3b82f6;
            --accent-muted: rgba(37, 99, 235, 0.15);
            --danger: #ef4444;
            --success: #22c55e;
            --text-main-light: #0f172a;
            --text-muted-light: #64748b;
            --text-main-dark: #e5e7eb;
            --text-muted-dark: #9ca3af;
            --border-soft-light: rgba(15, 23, 42, 0.08);
            --border-soft-dark: rgba(148, 163, 184, 0.3);
            --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.16);
            --radius-xl: 18px;
            --radius-2xl: 26px;
            --transition-fast: 0.18s ease-out;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
            "Segoe UI", sans-serif;
            background: radial-gradient(circle at top left, #eff6ff 0, #e0f2fe 38%, #e6f2ff 100%);
            color: var(--text-main-light);
        }

        body.dark {
            background: radial-gradient(circle at top left, #020617 0, #020617 45%, #020617 100%);
            color: var(--text-main-dark);
        }

        .dashboard-shell {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .dashboard-main {
            display: grid;
            grid-template-columns: 260px minmax(0, 1fr);
            gap: 18px;
            padding: 18px;
            max-width: 1400px;
            margin: 0 auto;
            box-sizing: border-box;
        }

        @media (max-width: 960px) {
            .dashboard-main {
                grid-template-columns: 1fr;
            }
        }

        /* Top bar */
        .topbar {
            position: sticky;
            top: 0;
            z-index: 20;
            backdrop-filter: blur(18px);
            background: linear-gradient(to right, rgba(226, 239, 255, 0.92), rgba(219, 234, 254, 0.88));
            border-bottom: 1px solid var(--border-soft-light);
            padding: 10px 18px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        body.dark .topbar {
            background: linear-gradient(to right, rgba(15, 23, 42, 0.92), rgba(15, 23, 42, 0.9));
            border-bottom-color: var(--border-soft-dark);
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-pill {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at 30% 20%, #60a5fa 0, #2563eb 35%, #1d4ed8 70%, #0f172a 100%);
            box-shadow: 0 12px 25px rgba(37, 99, 235, 0.55);
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .topbar-title {
            display: flex;
            flex-direction: column;
        }

        .topbar-title-main {
            font-weight: 650;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            font-size: 14px;
        }

        .topbar-title-sub {
            font-size: 11px;
            color: var(--text-muted-light);
        }

        body.dark .topbar-title-sub {
            color: var(--text-muted-dark);
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 11px;
            border: 1px solid var(--border-soft-light);
            background: rgba(255, 255, 255, 0.85);
            color: var(--text-muted-light);
        }

        body.dark .pill {
            border-color: var(--border-soft-dark);
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-muted-dark);
        }

        .status-dot {
            width: 9px;
            height: 9px;
            border-radius: 999px;
            background: var(--success);
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.18);
        }

        .status-dot.bad {
            background: var(--danger);
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .btn {
            border-radius: 999px;
            border: none;
            outline: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            padding: 6px 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: background var(--transition-fast), color var(--transition-fast),
            transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-soft));
            color: white;
            box-shadow: 0 12px 24px rgba(37, 99, 235, 0.35);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 16px 32px rgba(37, 99, 235, 0.45);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-soft-light);
            color: var(--text-main-light);
        }

        body.dark .btn-outline {
            border-color: var(--border-soft-dark);
            color: var(--text-main-dark);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .btn-icon {
            padding: 6px;
            border-radius: 999px;
            width: 30px;
            height: 30px;
            justify-content: center;
        }

        /* Sidebar */
        .sidebar {
            border-radius: var(--radius-2xl);
            padding: 14px 14px 18px;
            background: rgba(255, 255, 255, 0.92);
            border: 1px solid var(--border-soft-light);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        body.dark .sidebar {
            background: rgba(15, 23, 42, 0.92);
            border-color: var(--border-soft-dark);
        }

        .sidebar-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted-light);
            margin-bottom: 6px;
        }

        body.dark .sidebar-section-title {
            color: var(--text-muted-dark);
        }

        .nav-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .nav-item {
            border-radius: 999px;
            padding: 7px 12px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            color: var(--text-main-light);
            text-decoration: none;
            background: transparent;
            border: 1px solid transparent;
            transition: background var(--transition-fast), border-color var(--transition-fast),
            transform var(--transition-fast), box-shadow var(--transition-fast), color var(--transition-fast);
        }

        body.dark .nav-item {
            color: var(--text-main-dark);
        }

        .nav-item span.label {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item span.badge {
            font-size: 10px;
            padding: 2px 7px;
            border-radius: 999px;
            background: var(--accent-muted);
            color: var(--accent);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.96), rgba(59, 130, 246, 0.96));
            color: white;
            border-color: transparent;
            box-shadow: 0 12px 30px rgba(37, 99, 235, 0.6);
        }

        .nav-item:hover {
            border-color: var(--accent-soft);
            background: rgba(37, 99, 235, 0.08);
            transform: translateY(-1px);
        }

        .nav-item.active span.badge {
            background: rgba(15, 23, 42, 0.6);
            color: #e5e7eb;
        }

        /* Main content */
        .main-area {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .hero-card {
            border-radius: var(--radius-2xl);
            padding: 16px 18px 16px;
            background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.16), rgba(255, 255, 255, 0.94));
            border: 1px solid var(--border-soft-light);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        body.dark .hero-card {
            background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.35), rgba(15, 23, 42, 0.96));
            border-color: var(--border-soft-dark);
        }

        .hero-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .hero-title-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .hero-title {
            font-size: 16px;
            font-weight: 650;
        }

        .hero-subtitle {
            font-size: 12px;
            color: var(--text-muted-light);
        }

        body.dark .hero-subtitle {
            color: var(--text-muted-dark);
        }

        .hero-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: flex-end;
        }

        .hero-meta-row {
            display: flex;
            gap: 10px;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .mini-pill {
            border-radius: 999px;
            padding: 4px 9px;
            font-size: 11px;
            border: 1px dashed rgba(148, 163, 184, 0.8);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted-light);
            background: rgba(255, 255, 255, 0.72);
        }

        body.dark .mini-pill {
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-muted-dark);
            border-color: rgba(148, 163, 184, 0.7);
        }

        .dot-soft {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: #a855f7;
        }

        /* Cards grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 14px;
        }

        @media (max-width: 1120px) {
            .cards-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 720px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            border-radius: var(--radius-xl);
            padding: 12px 13px 13px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid var(--border-soft-light);
            box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12);
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-height: 120px;
        }

        body.dark .card {
            background: rgba(15, 23, 42, 0.96);
            border-color: var(--border-soft-dark);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .card-title {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .card-subtitle {
            font-size: 11px;
            color: var(--text-muted-light);
        }

        body.dark .card-subtitle {
            color: var(--text-muted-dark);
        }

        .card-body {
            font-size: 12px;
            color: var(--text-muted-light);
        }

        body.dark .card-body {
            color: var(--text-muted-dark);
        }

        .card-footer {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .chips-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .chip {
            font-size: 10px;
            padding: 3px 7px;
            border-radius: 999px;
            background: rgba(148, 163, 184, 0.15);
            color: var(--text-muted-light);
        }

        body.dark .chip {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-muted-dark);
        }

        /* AI Request mini panel */
        .ai-mini-input {
            width: 100%;
            margin-top: 6px;
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            padding: 6px 8px;
            font-size: 12px;
            resize: vertical;
            min-height: 42px;
            max-height: 120px;
            font-family: inherit;
            box-sizing: border-box;
            background: rgba(248, 250, 252, 0.95);
        }

        body.dark .ai-mini-input {
            background: rgba(15, 23, 42, 0.9);
            border-color: rgba(148, 163, 184, 0.7);
            color: var(--text-main-dark);
        }

        .ai-mini-output {
            margin-top: 6px;
            padding: 6px 8px;
            border-radius: 10px;
            font-size: 11px;
            line-height: 1.45;
            background: rgba(219, 234, 254, 0.9);
            color: #0f172a;
            max-height: 120px;
            overflow-y: auto;
        }

        body.dark .ai-mini-output {
            background: rgba(30, 64, 175, 0.9);
            color: #e5e7eb;
        }

        .ai-mini-output.empty {
            opacity: 0.7;
            font-style: italic;
        }

        .status-pill {
            font-size: 11px;
            padding: 3px 7px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(22, 163, 74, 0.08);
            color: var(--success);
        }

        .status-pill.error {
            background: rgba(239, 68, 68, 0.08);
            color: var(--danger);
        }

        .status-dot-mini {
            width: 7px;
            height: 7px;
            border-radius: 999px;
            background: currentColor;
        }

        /* Footer */
        .dashboard-footer {
            padding: 10px 18px 16px;
            font-size: 11px;
            color: var(--text-muted-light);
            display: flex;
            justify-content: space-between;
            gap: 8px;
            max-width: 1400px;
            margin: 0 auto;
            box-sizing: border-box;
        }

        body.dark .dashboard-footer {
            color: var(--text-muted-dark);
        }

        .link-muted {
            color: inherit;
            text-decoration: none;
            border-bottom: 1px dashed rgba(148, 163, 184, 0.6);
        }

        .link-muted:hover {
            border-bottom-style: solid;
        }

        /* Small helpers */
        .kbd {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 11px;
            padding: 1px 5px;
            border-radius: 4px;
            border: 1px solid rgba(148, 163, 184, 0.7);
            background: rgba(248, 250, 252, 0.9);
        }

        body.dark .kbd {
            background: rgba(15, 23, 42, 0.9);
        }
    </style>
</head>
<body>
<div class="dashboard-shell">
    <!-- TOP BAR -->
    <header class="topbar">
        <div class="topbar-left">
            <div class="logo-pill">L</div>
            <div class="topbar-title">
                <div class="topbar-title-main">LegalAI</div>
                <div class="topbar-title-sub">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ¬∑ Stage 10</div>
            </div>
        </div>
        <div class="topbar-right">
            <div class="pill" id="health-pill">
                <span class="status-dot" id="health-dot"></span>
                <span id="health-label">–ü—Ä–æ–≤–µ—Ä—è–µ–º backend‚Ä¶</span>
            </div>
            <button class="btn btn-outline btn-icon" id="theme-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                üåì
            </button>
            <button class="btn btn-primary" onclick="window.location.href = '/login';">
                –í–æ–π—Ç–∏
            </button>
        </div>
    </header>

    <!-- MAIN -->
    <main class="dashboard-main">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div>
                <div class="sidebar-section-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
                <ul class="nav-list">
                    <li>
                        <a href="/" class="nav-item">
                            <span class="label">üè† –ì–ª–∞–≤–Ω–∞—è</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard" class="nav-item active">
                            <span class="label">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                            <span class="badge">now</span>
                        </a>
                    </li>
                    <li>
                        <a href="/login" class="nav-item">
                            <span class="label">üîê –í—Ö–æ–¥</span>
                        </a>
                    </li>
                    <li>
                        <a href="/register" class="nav-item">
                            <span class="label">üßæ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div>
                <div class="sidebar-section-title">Backend API</div>
                <ul class="nav-list">
                    <li>
                        <button class="nav-item" type="button" onclick="openSwagger()">
                            <span class="label">üìö Swagger /docs</span>
                            <span class="badge">API</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-item" type="button" onclick="openEndpoint('/health')">
                            <span class="label">üíö /health</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-item" type="button" onclick="openEndpoint('/ai/ask')">
                            <span class="label">ü§ñ /ai/ask</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-item" type="button" onclick="openEndpoint('/legal-cases/search')">
                            <span class="label">‚öñÔ∏è /legal-cases/search</span>
                        </button>
                    </li>
                </ul>
            </div>

            <div>
                <div class="sidebar-section-title">–ü–æ–¥—Å–∫–∞–∑–∫–∞</div>
                <div class="card-body" style="font-size: 11px;">
                    ‚Ä¢ –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞—â–∏—â—ë–Ω–Ω—ã–º–∏ —Ä–æ—É—Ç–∞–º–∏ —Å–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑
                    <span class="kbd">/login</span>.<br />
                    ‚Ä¢ –ï—Å–ª–∏ backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
                    <span class="kbd">systemctl status legalai.service</span>.
                </div>
            </div>
        </aside>

        <!-- MAIN AREA -->
        <section class="main-area">
            <!-- HERO -->
            <section class="hero-card">
                <div class="hero-header">
                    <div class="hero-title-block">
                        <div class="hero-title">–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</div>
                        <div class="hero-subtitle">
                            –ó–¥–µ—Å—å –≤–∏–¥–Ω–æ, –∂–∏–≤ –ª–∏ backend, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –∏ —á—Ç–æ –∑–∞–ø—É—â–µ–Ω–æ.
                        </div>
                    </div>
                    <div class="hero-actions">
                        <button class="btn btn-outline" type="button" onclick="runHealthCheck(true)">
                            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
                        </button>
                        <button class="btn btn-primary" type="button" onclick="openSwagger()">
                            –û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API
                        </button>
                    </div>
                </div>
                <div class="hero-meta-row">
                    <div class="mini-pill">
                        <span class="dot-soft"></span>
                        Backend: <span id="backend-url-label"></span>
                    </div>
                    <div class="mini-pill" id="health-last-check-pill">
                        ‚è± –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: <span id="health-last-check">‚Äî</span>
                    </div>
                    <div class="mini-pill">
                        ‚öôÔ∏è –ú–æ–¥—É–ª–∏: auth ¬∑ docs ¬∑ ai ¬∑ cases
                    </div>
                </div>
            </section>

            <!-- GRID CARDS -->
            <section class="cards-grid">
                <!-- Card: Backend / Health -->
                <article class="card">
                    <div class="card-header">
                        <div class="card-title">
                            üí° –°–æ—Å—Ç–æ—è–Ω–∏–µ backend
                        </div>
                        <div id="backend-status-pill" class="status-pill">
                            <span class="status-dot-mini"></span>
                            <span id="backend-status-label">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="health-message">
                            –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ /health‚Ä¶
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="chips-row">
                            <span class="chip">FastAPI</span>
                            <span class="chip">Uvicorn</span>
                            <span class="chip">Nginx + SSL</span>
                        </div>
                        <button class="btn btn-outline" type="button" onclick="openEndpoint('/health')">
                            –û—Ç–∫—Ä—ã—Ç—å /health
                        </button>
                    </div>
                </article>

                <!-- Card: LegalDocAI -->
                <article class="card">
                    <div class="card-header">
                        <div class="card-title">
                            üìÑ –®–∞–±–ª–æ–Ω—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
                        </div>
                        <span class="card-subtitle">LegalDocAI ¬∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤</span>
                    </div>
                    <div class="card-body">
                        <p>
                            –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
                            <span class="kbd">/docs/templates</span> –∏
                            <span class="kbd">/docs/documents</span>. –î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.
                        </p>
                        <p id="docs-note" style="margin-top: 4px;">
                            –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–∫–∞ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Swagger.
                        </p>
                    </div>
                    <div class="card-footer">
                        <div class="chips-row">
                            <span class="chip">DOCX/PDF</span>
                            <span class="chip">Meta-–¥–∞–Ω–Ω—ã–µ</span>
                            <span class="chip">LegalDocAI</span>
                        </div>
                        <button class="btn btn-outline" type="button" onclick="openEndpoint('/docs')">
                            –û—Ç–∫—Ä—ã—Ç—å /docs
                        </button>
                    </div>
                </article>

                <!-- Card: AI mini console -->
                <article class="card">
                    <div class="card-header">
                        <div class="card-title">
                            ü§ñ –ë—ã—Å—Ç—Ä—ã–π –≤–æ–ø—Ä–æ—Å –ò–ò
                        </div>
                        <span class="card-subtitle">–ú–∏–Ω–∏-–∫–æ–Ω—Å–æ–ª—å –¥–ª—è /ai/ask (–¥–µ–º–æ)</span>
                    </div>
                    <div class="card-body">
                        <textarea id="ai-query" class="ai-mini-input"
                                  placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å (–±–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)‚Ä¶"></textarea>
                        <div class="card-footer" style="margin-top: 6px;">
                            <button class="btn btn-outline" type="button" onclick="sendAiAsk()">
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
                            </button>
                            <span style="font-size: 10px; color: inherit;">
                                –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∏–∂–µ ¬∑ –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å backend-–Ω–∞—Å—Ç—Ä–æ–µ–∫
                            </span>
                        </div>
                        <div id="ai-answer" class="ai-mini-output empty">
                            –û—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.
                        </div>
                    </div>
                </article>

                <!-- Card: Legal cases -->
                <article class="card">
                    <div class="card-header">
                        <div class="card-title">
                            ‚öñÔ∏è –°—É–¥–µ–±–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞
                        </div>
                        <span class="card-subtitle">/legal-cases/search</span>
                    </div>
                    <div class="card-body">
                        <p style="margin-bottom: 4px;">
                            –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –ø—Ä–∞–≤–æ–≤—ã—Ö –∞–∫—Ç–æ–≤ –∏ –¥–µ–ª. –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
                            (FTS + –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å).
                        </p>
                        <p style="font-size: 11px;">
                            –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è UI-—Å—Ç—Ä–∞–Ω–∏—Ü–∞, –Ω–æ —á–µ—Ä–µ–∑ dashboard –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä—è–º—ã–µ
                            –∑–∞–ø—Ä–æ—Å—ã –∫ API.
                        </p>
                    </div>
                    <div class="card-footer">
                        <div class="chips-row">
                            <span class="chip">FTS5</span>
                            <span class="chip">FAISS/HNSW</span>
                            <span class="chip">RU / UA / EN</span>
                        </div>
                        <button class="btn btn-outline" type="button" onclick="openEndpoint('/legal-cases/search')">
                            –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∏—Å–∫
                        </button>
                    </div>
                </article>

                <!-- Card: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ / –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <article class="card">
                    <div class="card-header">
                        <div class="card-title">
                            üì• –§–∞–π–ª—ã –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
                        </div>
                        <span class="card-subtitle">/consultations/upload</span>
                    </div>
                    <div class="card-body">
                        <p>
                            –ú–æ–¥—É–ª—å AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞—É–¥–∏–æ.
                            –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç.
                        </p>
                        <p style="font-size: 11px;">
                            –í API –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã:
                            <span class="kbd">POST /consultations/upload</span>,
                            <span class="kbd">GET /consultations</span>.
                        </p>
                    </div>
                    <div class="card-footer">
                        <div class="chips-row">
                            <span class="chip">PDF</span>
                            <span class="chip">Images</span>
                            <span class="chip">Audio ¬∑ ASR</span>
                        </div>
                        <button class="btn btn-outline" type="button" onclick="openSwagger()">
                            –°–º–æ—Ç—Ä–µ—Ç—å –≤ Swagger
                        </button>
                    </div>
                </article>

                <!-- Card: System & CI/CD -->
                <article class="card">
                    <div class="card-header">
                        <div class="card-title">
                            üõ† CI/CD –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                        </div>
                        <span class="card-subtitle">GitHub Actions ¬∑ Sentry ¬∑ Prometheus</span>
                    </div>
                    <div class="card-body">
                        <p>
                            –î–µ–ø–ª–æ–π backend –Ω–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ GitHub Actions, health-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏
                            systemd. Sentry –∏ Prometheus –ø–æ–º–æ–≥—É—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫—É.
                        </p>
                        <p style="font-size: 11px;">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. README –∏ –æ—Ç—á—ë—Ç—ã Stage 8‚Äì9.
                        </p>
                    </div>
                    <div class="card-footer">
                        <div class="chips-row">
                            <span class="chip">GitHub Actions</span>
                            <span class="chip">Sentry</span>
                            <span class="chip">Prometheus</span>
                        </div>
                        <button class="btn btn-outline" type="button" onclick="openSwagger()">
                            OpenAPI /docs
                        </button>
                    </div>
                </article>
            </section>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="dashboard-footer">
        <div>
            ¬© <span id="year"></span> LegalAI. –ù–µ —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π.
        </div>
        <div>
            –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± API —Å–º. <a href="https://api.legalai.su/docs" class="link-muted" target="_blank" rel="noreferrer">
            Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
        </a>.
        </div>
    </footer>
</div>

<script>
    (function () {
        const body = document.body;
        const THEME_KEY = 'legalai_theme';

        function applyTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark');
            } else {
                body.classList.remove('dark');
            }
        }

        function toggleTheme() {
            const current = body.classList.contains('dark') ? 'dark' : 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            localStorage.setItem(THEME_KEY, next);
            applyTheme(next);
        }

        const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
        applyTheme(savedTheme);

        const toggleBtn = document.getElementById('theme-toggle');
        if (toggleBtn) {
            toggleBtn.addEventListener('click', toggleTheme);
        }
    })();

    // Backend base URL: –ø—Ä–æ–¥ vs –ª–æ–∫–∞–ª—å–Ω–æ
    const API_BASE = (function () {
        const host = window.location.hostname;
        if (host.endsWith('legalai.su')) {
            return 'https://api.legalai.su';
        }
        // –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        return 'http://127.0.0.1:8000';
    })();

    document.getElementById('backend-url-label').textContent = API_BASE;

    function formatTime(date) {
        return date.toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
    }

    async function runHealthCheck(showAlert) {
        const pill = document.getElementById('health-pill');
        const dot = document.getElementById('health-dot');
        const label = document.getElementById('health-label');
        const statusPill = document.getElementById('backend-status-pill');
        const statusLabel = document.getElementById('backend-status-label');
        const msg = document.getElementById('health-message');
        const lastCheckElem = document.getElementById('health-last-check');

        pill.classList.remove('error');
        dot.classList.remove('bad');
        label.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º backend‚Ä¶';
        statusPill.classList.remove('error');
        statusLabel.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º‚Ä¶';

        try {
            const res = await fetch(API_BASE + '/health', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });

            const now = new Date();
            lastCheckElem.textContent = formatTime(now);

            if (!res.ok) {
                dot.classList.add('bad');
                pill.classList.add('error');
                statusPill.classList.add('error');
                label.textContent = '–û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç: ' + res.status;
                statusLabel.textContent = '–û—à–∏–±–∫–∞ ' + res.status;
                msg.textContent = 'Backend –æ—Ç–≤–µ—Ç–∏–ª –∫–æ–¥–æ–º ' + res.status + '. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ systemd –∏ nginx.';
                if (showAlert) {
                    alert('Backend –æ—Ç–≤–µ—Ç–∏–ª –∫–æ–¥–æ–º ' + res.status);
                }
                return;
            }

            let data = null;
            try {
                data = await res.json();
            } catch (e) {
                // fallback –µ—Å–ª–∏ /health –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON
            }

            dot.classList.remove('bad');
            pill.classList.remove('error');
            statusPill.classList.remove('error');
            label.textContent = 'Backend –æ–Ω–ª–∞–π–Ω';
            statusLabel.textContent = '–†–∞–±–æ—Ç–∞–µ—Ç';

            if (data && (data.status || data.detail)) {
                msg.textContent = '–û—Ç–≤–µ—Ç /health: ' + (data.status || data.detail);
            } else {
                msg.textContent = '–û—Ç–≤–µ—Ç /health –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ.';
            }
        } catch (err) {
            dot.classList.add('bad');
            pill.classList.add('error');
            statusPill.classList.add('error');
            label.textContent = 'Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
            statusLabel.textContent = '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
            document.getElementById('health-message').textContent =
                '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend –ø–æ –∞–¥—Ä–µ—Å—É ' + API_BASE +
                '. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É, systemd –∏ nginx.';
            if (showAlert) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend. –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. —Ç–µ–∫—Å—Ç –Ω–∞ –ø–∞–Ω–µ–ª–∏ ‚Äú–°–æ—Å—Ç–æ—è–Ω–∏–µ backend‚Äù.');
            }
        }
    }

    function openSwagger() {
        window.open(API_BASE + '/docs', '_blank', 'noopener');
    }

    function openEndpoint(path) {
        if (!path.startsWith('/')) {
            path = '/' + path;
        }
        window.open(API_BASE + path, '_blank', 'noopener');
    }

    async function sendAiAsk() {
        const textarea = document.getElementById('ai-query');
        const output = document.getElementById('ai-answer');

        const query = (textarea.value || '').trim();
        if (!query) {
            alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.');
            return;
        }

        output.classList.remove('empty');
        output.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å‚Ä¶';

        try {
            const res = await fetch(API_BASE + '/ai/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({ query: query })
            });

            if (!res.ok) {
                let detail = res.status + ' ' + res.statusText;
                try {
                    const errJson = await res.json();
                    if (errJson && errJson.detail) {
                        detail = errJson.detail;
                    }
                } catch (e) {
                    // ignore
                }
                output.textContent =
                    '–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç /ai/ask: ' + detail +
                    '. –í–æ–∑–º–æ–∂–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–ª–∏ –º–æ–¥—É–ª—å –ò–ò –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á—ë–Ω.';
                return;
            }

            let data;
            try {
                data = await res.json();
            } catch (e) {
                output.textContent = '–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å JSON.';
                return;
            }

            if (data && (data.answer || data.detail || typeof data === 'string')) {
                const answer = data.answer || data.detail || data.toString();
                output.textContent = answer;
            } else {
                output.textContent = '–û—Ç–≤–µ—Ç –æ—Ç –ò–ò –ø–æ–ª—É—á–µ–Ω, –Ω–æ –≤ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.';
            }
        } catch (err) {
            output.textContent =
                '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ /ai/ask. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ backend –∏ —Ä–∞–∑—Ä–µ—à—ë–Ω –ª–∏ CORS.';
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.getElementById('year').textContent = new Date().getFullYear();
    runHealthCheck(false);
</script>
</body>
</html>
